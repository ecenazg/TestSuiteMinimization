


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > RandomSearch</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">de.uni_passau.fim.se2.sbse.suite_minimisation.algorithms</a>
</div>

<h1>Coverage Summary for Class: RandomSearch (de.uni_passau.fim.se2.sbse.suite_minimisation.algorithms)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">RandomSearch</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/9)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/100)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/123)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package de.uni_passau.fim.se2.sbse.suite_minimisation.algorithms;
&nbsp;
&nbsp;import de.uni_passau.fim.se2.sbse.suite_minimisation.chromosomes.ChromosomeGenerator;
&nbsp;import de.uni_passau.fim.se2.sbse.suite_minimisation.chromosomes.TestSuiteChromosome;
&nbsp;import de.uni_passau.fim.se2.sbse.suite_minimisation.fitness_functions.FitnessFunction;
&nbsp;import de.uni_passau.fim.se2.sbse.suite_minimisation.stopping_conditions.StoppingCondition;
&nbsp;import de.uni_passau.fim.se2.sbse.suite_minimisation.utils.Randomness;
&nbsp;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Arrays;
&nbsp;import java.util.List;
&nbsp;
&nbsp;import static java.util.Objects.requireNonNull;
&nbsp;
&nbsp;public class RandomSearch implements GeneticAlgorithm&lt;TestSuiteChromosome&gt; {
&nbsp;
&nbsp;    private final StoppingCondition stoppingCondition;
&nbsp;    private final ChromosomeGenerator&lt;TestSuiteChromosome&gt; generator;
&nbsp;
&nbsp;    private final FitnessFunction&lt;TestSuiteChromosome&gt; sizeFF;      // minimizing
&nbsp;    private final FitnessFunction&lt;TestSuiteChromosome&gt; coverageFF;   // maximizing
&nbsp;
&nbsp;    // Needed for greedy seed
&nbsp;    private final boolean[][] coverageMatrix;
&nbsp;    private final int numberTestCases;
&nbsp;    private final int numberLines;
&nbsp;
&nbsp;    public RandomSearch(
&nbsp;            StoppingCondition stoppingCondition,
&nbsp;            ChromosomeGenerator&lt;TestSuiteChromosome&gt; generator,
&nbsp;            FitnessFunction&lt;TestSuiteChromosome&gt; sizeFF,
&nbsp;            FitnessFunction&lt;TestSuiteChromosome&gt; coverageFF,
&nbsp;            boolean[][] coverageMatrix,
&nbsp;            int numberTestCases,
&nbsp;            int numberLines
<b class="nc">&nbsp;    ) {</b>
<b class="nc">&nbsp;        this.stoppingCondition = requireNonNull(stoppingCondition);</b>
<b class="nc">&nbsp;        this.generator = requireNonNull(generator);</b>
<b class="nc">&nbsp;        this.sizeFF = requireNonNull(sizeFF);</b>
<b class="nc">&nbsp;        this.coverageFF = requireNonNull(coverageFF);</b>
&nbsp;
<b class="nc">&nbsp;        this.coverageMatrix = requireNonNull(coverageMatrix);</b>
<b class="nc">&nbsp;        this.numberTestCases = numberTestCases;</b>
<b class="nc">&nbsp;        this.numberLines = numberLines;</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    @Override
&nbsp;    public List&lt;TestSuiteChromosome&gt; findSolution() {
<b class="nc">&nbsp;        notifySearchStarted();</b>
&nbsp;
<b class="nc">&nbsp;        List&lt;TestSuiteChromosome&gt; paretoFront = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        TestSuiteChromosome template = generator.get();</b>
&nbsp;
&nbsp;        // (A) Always include full suite (anchors coverage end)
<b class="nc">&nbsp;        if (!searchMustStop()) {</b>
<b class="nc">&nbsp;            boolean[] all = new boolean[numberTestCases];</b>
<b class="nc">&nbsp;            Arrays.fill(all, true);</b>
<b class="nc">&nbsp;            evaluateAndInsert(new TestSuiteChromosome(all, template.getMutation(), template.getCrossover()), paretoFront);</b>
&nbsp;        }
&nbsp;
&nbsp;        // (B) Greedy prefixes: add best gain test iteratively, evaluate EACH prefix
<b class="nc">&nbsp;        if (!searchMustStop()) {</b>
<b class="nc">&nbsp;            addGreedyPrefixes(template, paretoFront);</b>
&nbsp;        }
&nbsp;
&nbsp;        // (C) Best-K singletons (instead of ALL singletons)
<b class="nc">&nbsp;        if (!searchMustStop()) {</b>
<b class="nc">&nbsp;            int K = Math.min(20, numberTestCases);</b>
<b class="nc">&nbsp;            int[] best = topKSingleTestsByCoverage(K);</b>
<b class="nc">&nbsp;            for (int idx : best) {</b>
<b class="nc">&nbsp;                if (searchMustStop()) break;</b>
<b class="nc">&nbsp;                boolean[] single = new boolean[numberTestCases];</b>
<b class="nc">&nbsp;                single[idx] = true;</b>
<b class="nc">&nbsp;                evaluateAndInsert(new TestSuiteChromosome(single, template.getMutation(), template.getCrossover()), paretoFront);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        // (D) Budget-efficient stratified random sampling until stop
<b class="nc">&nbsp;        while (!searchMustStop()) {</b>
<b class="nc">&nbsp;            boolean[] genes = sampleByTargetSize();</b>
<b class="nc">&nbsp;            evaluateAndInsert(new TestSuiteChromosome(genes, template.getMutation(), template.getCrossover()), paretoFront);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return paretoFront;</b>
&nbsp;    }
&nbsp;
&nbsp;    private void addGreedyPrefixes(TestSuiteChromosome template, List&lt;TestSuiteChromosome&gt; paretoFront) {
<b class="nc">&nbsp;        boolean[] genes = new boolean[numberTestCases];</b>
<b class="nc">&nbsp;        boolean[] covered = new boolean[numberLines];</b>
&nbsp;
<b class="nc">&nbsp;        while (!searchMustStop()) {</b>
<b class="nc">&nbsp;            int bestTest = -1;</b>
<b class="nc">&nbsp;            int bestGain = 0;</b>
&nbsp;
<b class="nc">&nbsp;            for (int t = 0; t &lt; numberTestCases; t++) {</b>
<b class="nc">&nbsp;                if (genes[t]) continue;</b>
&nbsp;
<b class="nc">&nbsp;                int gain = 0;</b>
<b class="nc">&nbsp;                for (int line = 0; line &lt; numberLines; line++) {</b>
<b class="nc">&nbsp;                    if (!covered[line] &amp;&amp; coverageMatrix[t][line]) gain++;</b>
&nbsp;                }
<b class="nc">&nbsp;                if (gain &gt; bestGain) {</b>
<b class="nc">&nbsp;                    bestGain = gain;</b>
<b class="nc">&nbsp;                    bestTest = t;</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (bestTest == -1 || bestGain == 0) break;</b>
&nbsp;
<b class="nc">&nbsp;            genes[bestTest] = true;</b>
<b class="nc">&nbsp;            for (int line = 0; line &lt; numberLines; line++) {</b>
<b class="nc">&nbsp;                covered[line] |= coverageMatrix[bestTest][line];</b>
&nbsp;            }
&nbsp;
&nbsp;            // Evaluate current prefix suite (THIS is the key improvement)
<b class="nc">&nbsp;            evaluateAndInsert(new TestSuiteChromosome(genes.clone(), template.getMutation(), template.getCrossover()), paretoFront);</b>
&nbsp;
&nbsp;            // Optional: stop if full coverage achieved
<b class="nc">&nbsp;            boolean done = true;</b>
<b class="nc">&nbsp;            for (boolean b : covered) {</b>
<b class="nc">&nbsp;                if (!b) { done = false; break; }</b>
&nbsp;            }
<b class="nc">&nbsp;            if (done) break;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private int[] topKSingleTestsByCoverage(int K) {
<b class="nc">&nbsp;        int n = numberTestCases;</b>
<b class="nc">&nbsp;        int[] cov = new int[n];</b>
<b class="nc">&nbsp;        for (int t = 0; t &lt; n; t++) {</b>
<b class="nc">&nbsp;            int c = 0;</b>
<b class="nc">&nbsp;            for (int line = 0; line &lt; numberLines; line++) {</b>
<b class="nc">&nbsp;                if (coverageMatrix[t][line]) c++;</b>
&nbsp;            }
<b class="nc">&nbsp;            cov[t] = c;</b>
&nbsp;        }
&nbsp;
&nbsp;        // Select top K indices by cov (simple partial selection)
<b class="nc">&nbsp;        int[] idx = new int[n];</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; n; i++) idx[i] = i;</b>
&nbsp;
&nbsp;        // Sort descending by coverage (n log n is fine for typical sizes)
<b class="nc">&nbsp;        Arrays.sort(idx);</b>
&nbsp;
<b class="nc">&nbsp;        return Arrays.copyOf(idx, K);</b>
&nbsp;    }
&nbsp;
&nbsp;    private boolean[] sampleByTargetSize() {
<b class="nc">&nbsp;        int n = numberTestCases;</b>
<b class="nc">&nbsp;        boolean[] genes = new boolean[n];</b>
&nbsp;
&nbsp;        // Bias towards smaller suites: k = 1 + floor((r^2) * (n-1))
<b class="nc">&nbsp;        double r = Randomness.random().nextDouble();</b>
<b class="nc">&nbsp;        int k = 1 + (int) Math.floor(r * r * (n - 1));</b>
&nbsp;
&nbsp;        // Pick k distinct indices using a partial Fisher-Yates shuffle on an index array
<b class="nc">&nbsp;        int[] pool = new int[n];</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; n; i++) pool[i] = i;</b>
&nbsp;
<b class="nc">&nbsp;        for (int i = 0; i &lt; k; i++) {</b>
<b class="nc">&nbsp;            int j = i + Randomness.random().nextInt(n - i);</b>
<b class="nc">&nbsp;            int tmp = pool[i]; pool[i] = pool[j]; pool[j] = tmp;</b>
<b class="nc">&nbsp;            genes[pool[i]] = true;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return genes;</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;
&nbsp;    @Override
&nbsp;    public StoppingCondition getStoppingCondition() {
<b class="nc">&nbsp;        return stoppingCondition;</b>
&nbsp;    }
&nbsp;
&nbsp;    private void evaluateAndInsert(
&nbsp;            TestSuiteChromosome c,
&nbsp;            List&lt;TestSuiteChromosome&gt; paretoFront
&nbsp;    ) {
&nbsp;        // Count exactly ONE evaluation per sampled solution (as required)
<b class="nc">&nbsp;        sizeFF.applyAsDouble(c);</b>
<b class="nc">&nbsp;        coverageFF.applyAsDouble(c);</b>
<b class="nc">&nbsp;        notifyFitnessEvaluation();</b>
&nbsp;
<b class="nc">&nbsp;        boolean dominated = false;</b>
<b class="nc">&nbsp;        List&lt;TestSuiteChromosome&gt; toRemove = new ArrayList&lt;&gt;();</b>
&nbsp;
<b class="nc">&nbsp;        for (TestSuiteChromosome p : paretoFront) {</b>
<b class="nc">&nbsp;            if (dominates(p, c)) {</b>
<b class="nc">&nbsp;                dominated = true;</b>
&nbsp;                break;
&nbsp;            }
<b class="nc">&nbsp;            if (dominates(c, p)) {</b>
<b class="nc">&nbsp;                toRemove.add(p);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (!dominated) {</b>
<b class="nc">&nbsp;            paretoFront.removeAll(toRemove);</b>
<b class="nc">&nbsp;            paretoFront.add(c);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Greedy seed: repeatedly add the test that covers the most currently-uncovered lines,
&nbsp;     * until we either cover all lines or no further improvement is possible.
&nbsp;     */
&nbsp;    private TestSuiteChromosome greedyCoverageSeed(TestSuiteChromosome template) {
<b class="nc">&nbsp;        boolean[] genes = new boolean[numberTestCases];</b>
<b class="nc">&nbsp;        boolean[] covered = new boolean[numberLines];</b>
&nbsp;
&nbsp;        while (true) {
<b class="nc">&nbsp;            int bestTest = -1;</b>
<b class="nc">&nbsp;            int bestGain = 0;</b>
&nbsp;
<b class="nc">&nbsp;            for (int t = 0; t &lt; numberTestCases; t++) {</b>
<b class="nc">&nbsp;                if (genes[t]) continue;</b>
&nbsp;
<b class="nc">&nbsp;                int gain = 0;</b>
<b class="nc">&nbsp;                for (int line = 0; line &lt; numberLines; line++) {</b>
<b class="nc">&nbsp;                    if (!covered[line] &amp;&amp; coverageMatrix[t][line]) {</b>
<b class="nc">&nbsp;                        gain++;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (gain &gt; bestGain) {</b>
<b class="nc">&nbsp;                    bestGain = gain;</b>
<b class="nc">&nbsp;                    bestTest = t;</b>
&nbsp;                }
&nbsp;            }
&nbsp;
&nbsp;            // No test can improve coverage anymore
<b class="nc">&nbsp;            if (bestTest == -1 || bestGain == 0) break;</b>
&nbsp;
<b class="nc">&nbsp;            genes[bestTest] = true;</b>
<b class="nc">&nbsp;            for (int line = 0; line &lt; numberLines; line++) {</b>
<b class="nc">&nbsp;                covered[line] |= coverageMatrix[bestTest][line];</b>
&nbsp;            }
&nbsp;
&nbsp;            // Stop early if fully covered
<b class="nc">&nbsp;            boolean done = true;</b>
<b class="nc">&nbsp;            for (boolean b : covered) {</b>
<b class="nc">&nbsp;                if (!b) {</b>
<b class="nc">&nbsp;                    done = false;</b>
&nbsp;                    break;
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            if (done) break;</b>
&nbsp;        }
&nbsp;
&nbsp;        // Ensure at least one test (your chromosome enforces it anyway, but keep it safe)
<b class="nc">&nbsp;        boolean any = false;</b>
<b class="nc">&nbsp;        for (boolean g : genes) {</b>
<b class="nc">&nbsp;            if (g) { any = true; break; }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (!any &amp;&amp; numberTestCases &gt; 0) {</b>
<b class="nc">&nbsp;            genes[0] = true;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return new TestSuiteChromosome(</b>
<b class="nc">&nbsp;                genes, template.getMutation(), template.getCrossover()</b>
&nbsp;        );
&nbsp;    }
&nbsp;    private boolean dominates(TestSuiteChromosome a, TestSuiteChromosome b) {
<b class="nc">&nbsp;        double aSize = sizeFF.applyAsDouble(a);</b>
<b class="nc">&nbsp;        double bSize = sizeFF.applyAsDouble(b);</b>
<b class="nc">&nbsp;        double aCov  = coverageFF.applyAsDouble(a);</b>
<b class="nc">&nbsp;        double bCov  = coverageFF.applyAsDouble(b);</b>
&nbsp;
<b class="nc">&nbsp;        boolean notWorse = aSize &lt;= bSize &amp;&amp; aCov &gt;= bCov;</b>
<b class="nc">&nbsp;        boolean better   = aSize &lt; bSize || aCov &gt; bCov;</b>
&nbsp;
<b class="nc">&nbsp;        return notWorse &amp;&amp; better;</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-12-13 22:10</div>
</div>
</body>
</html>
